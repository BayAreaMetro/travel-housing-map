<html>
	<head>
		<title>One Bay Area: Move / Maps</title>
		<style type="text/css">
			@import url(../style/screen.css);
		</style>
		<script type="text/javascript" src="js/LAB.min.js"></script>
		<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
		<script type="text/javascript" defer="defer">

			$LAB
			.setOptions({
				AlwaysPreserveOrder: true
			})
			.script("js/jquery-1.5.min.js")
			.script("js/polymaps.min.js")
			.script("js/htmapl.js")
			.script("js/utils.js")
			.script("js/autofill.js")
			.script("js/geocode.js")
			.script("/data/blk2taz/convert.js")
			.script("js/select-taz.js").wait(initialize);

			function initialize() {
				var map = $("#location-map").data("map");

				// move each <li>'s step into the text of its first <h2>
				var i = 0;
				$("ol.steps li")
					.css("list-style", "none")
					.find("h2:first-child")
					.prepend(function(n, content) {
						return ['<span class="step">', (++i), '.</span> '].join("");
					});

				$("#map-submit").click(function() {
					var container = $("#submit-location"),
							form = $("#taz-submit");
					container.find(".status").text("Looking up location...");
					var z = map.zoom();
					var data = {
						taz: "",
						zoom: z,
						center: formatLocation(map.center())
					};
					function submit() {
						for (var key in data) {
							form.find("input[name=" + key + "]").val(data[key]);
						}
						return form.submit();
					}

					// $("#select-location").addClass("complete");
					container.addClass("loading");
					try {
						location2taz(map.center(), {
							success: function(taz) {
								container.find(".status").text("Mapping, please wait...");
								container.removeClass("loading");
								container.addClass("submitting");
								data.taz = taz;
								submit();
							},
							error: function(req, err, status) {
								container.removeClass("loading");
								container.addClass("error")
								container.find(".status").text("ERROR: " + err);
							}
						});
					} catch (e) {
						container.removeClass("loading");
						tazInput.addClass("error").val("ERROR: " + e);
					}
					// don't submit the form!
					return false;
				});
			}

		</script>
	</head>
	<body>
		<div id="page">

			<h1><a href="/">Move</a> / Maps</h1>

			<form class="autofill" action="time.html" method="GET">

				<ol class="steps">
					<li id="select-location">
						<h2>Select a location:</h2>

						<div class="map drag hash" id="location-map" data-zoomRange="7,17">
							<input type="hidden" name="location" value="37.7639,-122.4130"/>
							<input type="hidden" name="zoom" value="9"/>
							<div class="layer" data-type="image"
								data-url="http://a.acetate.geoiq.com/tiles/acetate-base/{Z}/{X}/{Y}.png"></div>
							<div class="layer" data-type="image"
								data-url="http://a.acetate.geoiq.com/tiles/acetate-roads/{Z}/{X}/{Y}.png"></div>
							<div class="layer" data-type="image"
								data-url="http://a.acetate.geoiq.com/tiles/acetate-labels/{Z}/{X}/{Y}.png"></div>
							<!--
							<div class="layer" data-type="image"
								data-url="http://c.tile.cloudmade.com/1a1b06b230af4efdbb989ea99e9841af/998/256/{Z}/{X}/{Y}.png"></div>
							-->
							<div class="crosshairs"></div>
							<div class="controls">
								<label>Zoom:</label> <a class="zoom-in" href="#location-map"><img alt="in" src="../style/images/zoom-plus.png"/></a>
								<a class="zoom-out" href="#location-map"><img alt="out" src="../style/images/zoom-minus.png"/></a>
							</div>

							<div id="geocoder">
								<p>
									<label for="address">Find your address:</label>
									<input accesskey="a" type="search" results="5" name="address" value="" data-default="enter your address"/>
									<input type="submit" name="geocode" value="Search"/>
								</p>
								<p class="status error">Unable to geocode: <tt>foo</tt></p>
							</div>
						</div>
					</li>

					<li id="submit-location">
						<h2><input id="map-submit" type="submit" value="Map It!"/> <span class="status"></span></h2>
					</li>

				</ol>

			</form>

			<form id="taz-submit" action="time.html" method="GET">
				<input type="hidden" name="taz"/>
				<input type="hidden" name="center"/>
				<input type="hidden" name="zoom"/>
			</form>
		</div>
	</body>
</html>
